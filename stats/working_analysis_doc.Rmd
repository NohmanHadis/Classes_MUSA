---
title: "working_on_HW1"
author: "Timothy Oliver"
date: "2023-09-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=F)
```

# Getting Data

```{r cars}
library(sf)
library(ggplot2)

options(scipen=999)
# huh

# data here
## if needed ...
csv <- read.csv("../RegressionData.csv")
shp <- st_read("../Lecture 1 - RegressionData.shp/RegressionData.shp")
```

## Describing Variables

The standard deviation of dependent variable, MEDHVAL, is `r sd(csv$MEDHVAL)`. The mean is `r mean(csv$MEDHVAL)`. A histogram for it is as follows.

```{r desc_MEDHVAL, echo=FALSE}

hist(csv$MEDHVAL, breaks=25)
```

It appears to have a distribution that is ...



The standard deviation of dependent variable, PCTBACHMOR, is `r sd(csv$PCTBACHMOR)`. The mean is `r mean(csv$PCTBACHMOR)`. A histogram for it is as follows.

```{r desc_PCTBACHMOR, echo=FALSE}

hist(csv$PCTBACHMOR, breaks=25)
```

It appears to have a distribution that is ...


The standard deviation of dependent variable, NBELPOV100, is `r sd(csv$NBELPOV100)`. The mean is `r mean(csv$NBELPOV100)`. A histogram for it is as follows.

```{r desc_NBELPOV100, echo=FALSE}
hist(csv$NBELPOV100, breaks=25)
```

It appears to have a distribution that is ...


The standard deviation of dependent variable, PCTVACANT, is `r sd(csv$PCTVACANT)`. The mean is `r mean(csv$PCTVACANT)`. A histogram for it is as follows.

```{r desc_PCTVACANT, echo=FALSE}
hist(csv$PCTVACANT, breaks=25)
```

It appears to have a distribution that is ...


The standard deviation of dependent variable, PCTSINGLES, is `r sd(csv$PCTSINGLES)`. The mean is `r mean(csv$PCTSINGLES)`. A histogram for it is as follows.

```{r desc_PCTSINGLES, echo=FALSE}
hist(csv$PCTSINGLES, breaks=25)
```

It appears to have a distribution that is ...


Then, we create log transforms of all variables (dependent and predictors).

```{r log_transforming}

csv$LNMEDHVAL <- log(csv$MEDHVAL)
csv$LNPCTBACHMOR <- log(1+csv$PCTBACHMOR)
csv$LNNBELPOV100 <- log(1+csv$NBELPOV100)
csv$LNPCTVACANT <- log(1+csv$PCTVACANT)
csv$LNPCTSINGLES <- log(1+csv$PCTSINGLES)
```

```{r log_hists}
hist(csv$LNMEDHVAL, breaks=25)
hist(csv$LNPCTBACHMOR, breaks=25)
hist(csv$LNNBELPOV100, breaks=25)
hist(csv$LNPCTVACANT, breaks=25)
hist(csv$LNPCTSINGLES, breaks=25)
```

We will use the log-transformed MEDHVAL & NBELPOV100; the rest will use the untransformed variables.

```{r scatter_plots}
plot(csv$PCTBACHMOR,csv$LNMEDHVAL)
plot(csv$LNNBELPOV100,csv$LNMEDHVAL)
plot(csv$PCTVACANT,csv$LNMEDHVAL)
plot(csv$PCTSINGLES,csv$LNMEDHVAL)
```

```{r correlations}
cor(csv[c(4,11,6,7)])
```
The percentage of people with bachelor's degrees or higher education does not have strong correlation with any other predictor with the strongest correlation being a coefficient of -0.3198 with the natural logarithm of those below the poverty level.
The natural log of those below 100% of the poverty level is not co-linear with any other predictor. Nor is the percent of household vacancies or the percent of single unit households.

```{r plotting_shp}
ggplot(data=shp)+geom_sf(fill=shp$LNMEDHVAL)
## can't have fill = 0?
## AND USE QUANTILES!
ggplot(data=shp)+geom_sf(fill=shp$PCTVACANT+1)+labs(y= "Percentage of Vacant Housing Units + 1 Percent")
ggplot(data=shp)+geom_sf(fill=shp$PCTSINGLES+1)+labs(y= "Percentage of Single Housing Units + 1 Percent")
ggplot(data=shp)+geom_sf(fill=shp$PCTBACHMOR+1)+labs(y= "Percentage of Respondents with Bachelor's Degrees or Higher + 1 Percent")
# what's the 'finite \'xlim\' values' error? --using plot
## can't have fill = 0?
ggplot(data=shp)+geom_sf(fill=shp$LNNBELPOV+1)+labs(y= "Natural Log of Number Below Poverty Line + 1 Unit")

```

# Part 2: lm() and anova()

```{r lm}
regA <- lm(data=shp,LNMEDHVAL~PCTVACANT+PCTSINGLES+PCTBACHMOR+LNNBELPOV)

summary(regA)

anova(regA)
```

```{r predicteds_and_residuals}
shp$predicted<-fitted(regA)
shp$residuals<-residuals(regA)
shp$stand_resid<-rstandard(regA)

# touch up to have labels and such
plot(x=shp$predicted,y=shp$stand_resid)

```

```{r MASS_commands}
# how to use
MASS::stepAIC(regA,direction="both")$anova
```

```{r DAAG_commands}
# how to use
if (!"DAAG" %in% installed.packages()){
  install.packages("DAAG")
}
library(DAAG)
cv<- DAAG::CVlm(data=as.data.frame(shp),regA,m=5)
mse <- attr(cv,"ms")
rmse <- sqrt(mse)
rmse
```

```{r final_histogram_and_choropleth}
hist(shp$stand_resid) # maybe breaks
min_st_red <- min(shp$stand_resid)
centered_stand_resid <- shp$stand_resid-min_st_red
ggplot(data=shp)+geom_sf(fill=centered_stand_resid+1)
```